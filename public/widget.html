<!-- ðŸ’¬ Shira Assistant Widget â€“ Final Production Version -->
<style>
#shira-bubble {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg,#0078ff,#00c6ff);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 26px;
  cursor: pointer;
  box-shadow: 0 4px 14px rgba(0,120,255,0.4);
  z-index: 9999;
  transition: transform .2s ease;
}
#shira-bubble:hover { transform: scale(1.08); }

#shira-chat {
  position: fixed;
  bottom: 95px;
  right: 25px;
  width: 300px;
  max-height: 420px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 9999;
}
#shira-header {
  background: #0078ff;
  color: #fff;
  padding: 10px;
  font-weight: 600;
  font-size: 1rem;
  text-align: center;
}
#shira-messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  font-size: 0.9rem;
  color: #333;
  scroll-behavior: smooth;
}
#shira-input {
  display: flex;
  border-top: 1px solid #ddd;
}
#shira-input input {
  flex: 1;
  border: none;
  padding: 10px;
  font-size: 0.9rem;
  outline: none;
}
#shira-input button {
  background: #0078ff;
  color: #fff;
  border: none;
  padding: 0 15px;
  cursor: pointer;
  font-weight: 600;
}
.shira-msg { margin: 6px 0; line-height: 1.4; word-wrap: break-word; }
.shira-user { text-align: right; color: #0078ff; }
.shira-bot { text-align: left; color: #333; }
</style>

<div id="shira-bubble">ðŸ’¬</div>

<div id="shira-chat">
  <div id="shira-header">Shira â€¢ SpotAlert Assistant</div>
  <div id="shira-messages">
    <div class="shira-msg shira-bot">
      ðŸ‘‹ Hi! I'm Shira. Ask me anything about SpotAlert â€” setup, alerts, plans, or camera connection.
    </div>
  </div>
  <div id="shira-input">
    <input type="text" id="userInput" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const bubble = document.getElementById("shira-bubble");
const chat = document.getElementById("shira-chat");
const sendBtn = document.getElementById("sendBtn");
const input = document.getElementById("userInput");
const messages = document.getElementById("shira-messages");

bubble.addEventListener("click", () => {
  chat.style.display = (chat.style.display === "flex") ? "none" : "flex";
});

function appendMessage(text, sender="bot"){
  const msg = document.createElement("div");
  msg.className = `shira-msg shira-${sender}`;
  msg.textContent = text;
  messages.appendChild(msg);
  messages.scrollTop = messages.scrollHeight;
}

async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;

  appendMessage(text,"user");
  input.value="";
  appendMessage("...", "bot");

  try {
    const res = await fetch("https://api.spotalert.live/api/shira", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        message: text,
        token: localStorage.getItem("token") || null,
        user: localStorage.getItem("spotalert_user") || null
      })
    });

    const data = await res.json();
    messages.lastChild.remove();
    appendMessage(data.reply || "No reply available.","bot");

  } catch (err) {
    messages.lastChild.remove();
    appendMessage("âš ï¸ Connection error. Please try again.","bot");
  }
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keypress", e => {
  if(e.key==="Enter") sendMessage();
});
</script>
